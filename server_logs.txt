Server running on port 3000
MongoDB connected
==== WEBHOOK REQUEST RECEIVED ====
Headers: {
  "host": "localhost:3000",
  "user-agent": "curl/8.7.1",
  "accept": "*/*",
  "content-type": "application/json",
  "content-length": "369"
}
Body: {
  "object": "instagram",
  "entry": [
    {
      "id": "17841473456214137",
      "messaging": [
        {
          "sender": {
            "id": "3658535154448239"
          },
          "recipient": {
            "id": "17841473456214137"
          },
          "timestamp": 1745259416120,
          "message": {
            "mid": "mwQfZAG1faXRlbToXOkHTWv2cZFnZAU1EQjE3OQoXMcZNDlZMjtyMTlMjgwOTcxcx",
            "text": "I recommend you try Burger Barn in Chicago. They have the best bacon cheeseburgers and milkshakes!"
          }
        }
      ]
    }
  ]
}
Processing messaging event: [
  {
    "sender": {
      "id": "3658535154448239"
    },
    "recipient": {
      "id": "17841473456214137"
    },
    "timestamp": 1745259416120,
    "message": {
      "mid": "mwQfZAG1faXRlbToXOkHTWv2cZFnZAU1EQjE3OQoXMcZNDlZMjtyMTlMjgwOTcxcx",
      "text": "I recommend you try Burger Barn in Chicago. They have the best bacon cheeseburgers and milkshakes!"
    }
  }
]
==== PROCESSING INSTAGRAM MESSAGE ====
Message data: {
  "sender": {
    "id": "3658535154448239"
  },
  "recipient": {
    "id": "17841473456214137"
  },
  "timestamp": 1745259416120,
  "message": {
    "mid": "mwQfZAG1faXRlbToXOkHTWv2cZFnZAU1EQjE3OQoXMcZNDlZMjtyMTlMjgwOTcxcx",
    "text": "I recommend you try Burger Barn in Chicago. They have the best bacon cheeseburgers and milkshakes!"
  }
}
Processing message from 3658535154448239: I recommend you try Burger Barn in Chicago. They have the best bacon cheeseburgers and milkshakes!
[0mPOST /webhook [32m200[0m 9.251 ms - 2[0m
User not found for Instagram ID: 3658535154448239
No user found for Instagram ID: 3658535154448239, creating a mock user for testing
Created mock user: {
  "_id": "mock_user_3658535154448239",
  "name": "Mock Test User",
  "email": "mock_3658535154448239@example.com",
  "instagramId": "3658535154448239"
}
Message identified as restaurant recommendation
RestaurantService instance created successfully
Calling processRecommendation with: {
  message: 'I recommend you try Burger Barn in Chicago. They have the best bacon cheeseburgers and milkshakes!',
  userId: 'mock_user_3658535154448239',
  instagramUserId: '3658535154448239'
}
Extracting restaurant info from: I recommend you try Burger Barn in Chicago. They have the best bacon cheeseburgers and milkshakes!
Error enriching with Google Places: Google Places API key is not configured
Error processing restaurant recommendation: Error: Restaurant validation failed: userId: Cast to ObjectId failed for value "mock_user_3658535154448239" (type string) at path "userId" because of "BSONError", priceRange: `null` is not a valid enum value for path `priceRange`.
    at ValidationError.inspect (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/error/validation.js:50:26)
    at formatValue (node:internal/util/inspect:805:19)
    at inspect (node:internal/util/inspect:364:10)
    at formatWithOptionsInternal (node:internal/util/inspect:2279:40)
    at formatWithOptions (node:internal/util/inspect:2141:10)
    at console.value (node:internal/console/constructor:352:14)
    at console.warn (node:internal/console/constructor:385:61)
    at RestaurantService.processRecommendation (/Users/namanrathi946/Documents/UniDine Bot/UniDine/src/services/restaurant-service.js:61:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async handleInstagramMessage (/Users/namanrathi946/Documents/UniDine Bot/UniDine/index.js:638:28) {
  errors: {
    userId: CastError: Cast to ObjectId failed for value "mock_user_3658535154448239" (type string) at path "userId" because of "BSONError"
        at ObjectId.cast (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/schema/objectid.js:250:11)
        at SchemaType.applySetters (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/schematype.js:1219:12)
        at model.$set (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:1422:22)
        at model.$set (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:1119:16)
        at model.Document (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:165:12)
        at model.Model (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/model.js:123:12)
        at new model (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/model.js:4758:15)
        at RestaurantService.processRecommendation (/Users/namanrathi946/Documents/UniDine Bot/UniDine/src/services/restaurant-service.js:56:31)
        at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
        at async handleInstagramMessage (/Users/namanrathi946/Documents/UniDine Bot/UniDine/index.js:638:28) {
      stringValue: '"mock_user_3658535154448239"',
      messageFormat: undefined,
      kind: 'ObjectId',
      value: 'mock_user_3658535154448239',
      path: 'userId',
      reason: BSONError: Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer
          at new ObjectId (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/bson/lib/bson.cjs:2055:23)
          at castObjectId (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/cast/objectid.js:25:12)
          at ObjectId.cast (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/schema/objectid.js:248:12)
          at SchemaType.applySetters (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/schematype.js:1219:12)
          at model.$set (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:1422:22)
          at model.$set (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:1119:16)
          at model.Document (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:165:12)
          at model.Model (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/model.js:123:12)
          at new model (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/model.js:4758:15)
          at RestaurantService.processRecommendation (/Users/namanrathi946/Documents/UniDine Bot/UniDine/src/services/restaurant-service.js:56:31),
      valueType: 'string'
    },
    priceRange: ValidatorError: `null` is not a valid enum value for path `priceRange`.
        at validate (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/schematype.js:1365:13)
        at SchemaType.doValidate (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/schematype.js:1349:7)
        at /Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:3004:18
        at process.processTicksAndRejections (node:internal/process/task_queues:77:11) {
      properties: [Object],
      kind: 'enum',
      path: 'priceRange',
      value: null,
      reason: undefined,
      [Symbol(mongoose:validatorError)]: true
    }
  },
  _message: 'Restaurant validation failed'
}
Error processing restaurant: Error: Restaurant validation failed: userId: Cast to ObjectId failed for value "mock_user_3658535154448239" (type string) at path "userId" because of "BSONError", priceRange: `null` is not a valid enum value for path `priceRange`.
    at ValidationError.inspect (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/error/validation.js:50:26)
    at formatValue (node:internal/util/inspect:805:19)
    at inspect (node:internal/util/inspect:364:10)
    at formatWithOptionsInternal (node:internal/util/inspect:2279:40)
    at formatWithOptions (node:internal/util/inspect:2141:10)
    at console.value (node:internal/console/constructor:352:14)
    at console.warn (node:internal/console/constructor:385:61)
    at handleInstagramMessage (/Users/namanrathi946/Documents/UniDine Bot/UniDine/index.js:651:17)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async /Users/namanrathi946/Documents/UniDine Bot/UniDine/index.js:533:11 {
  errors: {
    userId: CastError: Cast to ObjectId failed for value "mock_user_3658535154448239" (type string) at path "userId" because of "BSONError"
        at ObjectId.cast (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/schema/objectid.js:250:11)
        at SchemaType.applySetters (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/schematype.js:1219:12)
        at model.$set (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:1422:22)
        at model.$set (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:1119:16)
        at model.Document (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:165:12)
        at model.Model (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/model.js:123:12)
        at new model (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/model.js:4758:15)
        at RestaurantService.processRecommendation (/Users/namanrathi946/Documents/UniDine Bot/UniDine/src/services/restaurant-service.js:56:31)
        at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
        at async handleInstagramMessage (/Users/namanrathi946/Documents/UniDine Bot/UniDine/index.js:638:28) {
      stringValue: '"mock_user_3658535154448239"',
      messageFormat: undefined,
      kind: 'ObjectId',
      value: 'mock_user_3658535154448239',
      path: 'userId',
      reason: BSONError: Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer
          at new ObjectId (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/bson/lib/bson.cjs:2055:23)
          at castObjectId (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/cast/objectid.js:25:12)
          at ObjectId.cast (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/schema/objectid.js:248:12)
          at SchemaType.applySetters (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/schematype.js:1219:12)
          at model.$set (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:1422:22)
          at model.$set (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:1119:16)
          at model.Document (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:165:12)
          at model.Model (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/model.js:123:12)
          at new model (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/model.js:4758:15)
          at RestaurantService.processRecommendation (/Users/namanrathi946/Documents/UniDine Bot/UniDine/src/services/restaurant-service.js:56:31),
      valueType: 'string'
    },
    priceRange: ValidatorError: `null` is not a valid enum value for path `priceRange`.
        at validate (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/schematype.js:1365:13)
        at SchemaType.doValidate (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/schematype.js:1349:7)
        at /Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:3004:18
        at process.processTicksAndRejections (node:internal/process/task_queues:77:11) {
      properties: [Object],
      kind: 'enum',
      path: 'priceRange',
      value: null,
      reason: undefined,
      [Symbol(mongoose:validatorError)]: true
    }
  },
  _message: 'Restaurant validation failed'
}
Error stack: ValidationError: Restaurant validation failed: userId: Cast to ObjectId failed for value "mock_user_3658535154448239" (type string) at path "userId" because of "BSONError", priceRange: `null` is not a valid enum value for path `priceRange`.
    at Document.invalidate (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:3219:32)
    at model.$set (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:1464:12)
    at model.$set (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:1119:16)
    at model.Document (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/document.js:165:12)
    at model.Model (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/model.js:123:12)
    at new model (/Users/namanrathi946/Documents/UniDine Bot/UniDine/node_modules/mongoose/lib/model.js:4758:15)
    at RestaurantService.processRecommendation (/Users/namanrathi946/Documents/UniDine Bot/UniDine/src/services/restaurant-service.js:56:31)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async handleInstagramMessage (/Users/namanrathi946/Documents/UniDine Bot/UniDine/index.js:638:28)
    at async /Users/namanrathi946/Documents/UniDine Bot/UniDine/index.js:533:11
